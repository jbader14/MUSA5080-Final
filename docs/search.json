[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MUSA 5080 Final Project",
    "section": "",
    "text": "Executive Summary (For the Mayor and SEPTA Board):\nTraditional predictive models for public transit planning and other industries alike were rendered after the detrimental societal effects of the COVID-19 pandemic. For SEPTA in Philadelphia, there was no data recorded for an entire calendar year in 2020, severely dampening the predictive power of historical transit data. This project aims at the development of a new predictive framework for SEPTA bus ridership, instead of modeling a simple trend analysis around bus demand. We want the differential recovery of neighborhoods to event like the COVID pandemic to be at the forefront of our model, based on socioeconomic patterns in Philadelphia. Census tracts characterized as high-poverty neighborhoods experienced the highest losses to bus ridership from the pandemic shock and the highest gains post-pandemic, This illustrates low-income workers to be the backbone of the SEPTA system. Their ridership provides a “floor” that protected total system collapse in 2021, while they are driving current ridership recovery back to pre-COVID levels. Intuitively, lower income workers tend to work essential jobs that cannot be done remotely, leading to their larger contributions in ridership levels.\nOur final model (Negative Binomial with Fixed Effects and Demographic Interactions) accurately predicts ridership by tract with an average error of around 213 daily riders. We argue that SEPTA’s current capital planning does not align with the reality of continuing to protect and provide for underserved communities. Not only because it is the ethical thing to do, but also they are their strongest customer base. Our recommendation is to shift investment strategies to protecting high-ridership, high-poverty areas as “Transit Resilience Zones”. These zones require additional route frequency and physical infrastructure (bus shelters) to provide to these higher demand communities. Lastly, these zones also must be protected against route terminations from any future SEPTA budget constraints.\n\nMembers: Jack Bader, Joey Cahill, Sam Sen,\nDate: December 8th, 2025"
  },
  {
    "objectID": "appendix/appendix.html",
    "href": "appendix/appendix.html",
    "title": "Technical Appendix",
    "section": "",
    "text": "Code\n# Core tidyverse\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(lubridate)\n\n# Spatial data\nlibrary(sf)\nlibrary(tigris)\n\n# Census data\nlibrary(tidycensus)\n\n# Weather data\nlibrary(riem)  # For Philadelphia weather from ASOS stations\n\n# Visualization\nlibrary(viridis)\nlibrary(grid)\nlibrary(gridExtra)\nlibrary(knitr)\nlibrary(kableExtra)\n\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(patchwork)\n\n# here!\nlibrary(here)\n\n# Extra\nlibrary(tidytext)\nlibrary(MASS)\n\n# Get rid of scientific notation. We gotta look good!\noptions(scipen = 999)\n\n\n\n\n\n\n\nCode\nkey &lt;- Sys.getenv(\"CENSUS_API_KEY\")\ncensus_api_key(key)"
  },
  {
    "objectID": "appendix/appendix.html#load-libraries",
    "href": "appendix/appendix.html#load-libraries",
    "title": "Technical Appendix",
    "section": "",
    "text": "Code\n# Core tidyverse\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(lubridate)\n\n# Spatial data\nlibrary(sf)\nlibrary(tigris)\n\n# Census data\nlibrary(tidycensus)\n\n# Weather data\nlibrary(riem)  # For Philadelphia weather from ASOS stations\n\n# Visualization\nlibrary(viridis)\nlibrary(grid)\nlibrary(gridExtra)\nlibrary(knitr)\nlibrary(kableExtra)\n\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(patchwork)\n\n# here!\nlibrary(here)\n\n# Extra\nlibrary(tidytext)\nlibrary(MASS)\n\n# Get rid of scientific notation. We gotta look good!\noptions(scipen = 999)"
  },
  {
    "objectID": "appendix/appendix.html#define-themes",
    "href": "appendix/appendix.html#define-themes",
    "title": "Technical Appendix",
    "section": "",
    "text": "Code\nplotTheme &lt;- theme(\n  plot.title = element_text(size = 14, face = \"bold\"),\n  plot.subtitle = element_text(size = 10),\n  plot.caption = element_text(size = 8),\n  axis.text.x = element_text(size = 10, angle = 45, hjust = 1),\n  axis.text.y = element_text(size = 10),\n  axis.title = element_text(size = 11, face = \"bold\"),\n  panel.background = element_blank(),\n  panel.grid.major = element_line(colour = \"#D0D0D0\", size = 0.2),\n  panel.grid.minor = element_blank(),\n  axis.ticks = element_blank(),\n  legend.position = \"right\"\n)\n\nmapTheme &lt;- theme(\n  plot.title = element_text(size = 14, face = \"bold\"),\n  plot.subtitle = element_text(size = 10),\n  plot.caption = element_text(size = 8),\n  axis.line = element_blank(),\n  axis.text = element_blank(),\n  axis.ticks = element_blank(),\n  axis.title = element_blank(),\n  panel.background = element_blank(),\n  panel.border = element_blank(),\n  panel.grid.major = element_line(colour = 'transparent'),\n  panel.grid.minor = element_blank(),\n  legend.position = \"right\",\n  plot.margin = margin(1, 1, 1, 1, 'cm'),\n  legend.key.height = unit(1, \"cm\"),\n  legend.key.width = unit(0.2, \"cm\")\n)\n\npalette5 &lt;- c(\"#eff3ff\", \"#bdd7e7\", \"#6baed6\", \"#3182bd\", \"#08519c\")"
  },
  {
    "objectID": "appendix/appendix.html#set-census-api-key",
    "href": "appendix/appendix.html#set-census-api-key",
    "title": "Technical Appendix",
    "section": "",
    "text": "Code\nkey &lt;- Sys.getenv(\"CENSUS_API_KEY\")\ncensus_api_key(key)"
  },
  {
    "objectID": "appendix/appendix.html#monthly-average-daily-ridership-by-transit-mode",
    "href": "appendix/appendix.html#monthly-average-daily-ridership-by-transit-mode",
    "title": "Technical Appendix",
    "section": "Monthly Average Daily Ridership by Transit Mode",
    "text": "Monthly Average Daily Ridership by Transit Mode\n\n\nCode\n# Engineer a date feature for plotting\ntransit_mode_monthly &lt;- transit_mode |&gt;\n  mutate(\n    date = ymd(paste(Calendar_Year, Calendar_Month, \"01\", sep = \"-\"))\n  )\n\n# Plot line chart with a line for each transit mode over time\nggplot(transit_mode_monthly,\n       aes(x = date,\n           y = Average_Daily_Ridership,\n           color = Mode)) +\n  geom_line(linewidth = 1) +\n  labs(\n    title = \"Monthly Average Daily Ridership by Transit Mode\",\n    subtitle = \"SEPTA in Philadelphia from 2019 - 2025\",\n    x = \"Date\",\n    y = \"Average Daily Ridership\",\n    color = \"Transit Mode\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "appendix/appendix.html#total-bus-ridership-by-day-of-week-philadelphia-census-tracts",
    "href": "appendix/appendix.html#total-bus-ridership-by-day-of-week-philadelphia-census-tracts",
    "title": "Technical Appendix",
    "section": "Total Bus Ridership by Day of Week, Philadelphia Census Tracts",
    "text": "Total Bus Ridership by Day of Week, Philadelphia Census Tracts\n\n\nCode\n# Filter to Philadelphia County and clean fields\nbus_tract_phila &lt;- bus_tract %&gt;%\n  filter(County_Name == \"Philadelphia County\") %&gt;%\n  mutate(\n    year = as.integer(stringr::str_extract(Season, \"\\\\d{4}\")),\n    total_ridership = On_ + Off_\n  )\n\n# Aggregate to total ridership by year and day-of-week\nbus_tract_year_dow &lt;- bus_tract_phila %&gt;%\n  group_by(year, Day_of_Week) %&gt;%\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Minimal line plot of total ridership over time by day-of-week\nggplot(bus_tract_year_dow,\n       aes(x = year, y = total_ridership, color = Day_of_Week)) +\n  geom_line(linewidth = 0.9) +\n  geom_point(size = 1.8) +\n  labs(\n    title = \"Total SEPTA Bus Ridership by Day of Week\",\n    subtitle = \"Average daily boardings + departures for Fall only\",\n    x = \"Year\",\n    y = \"Total Average Daily Ridership\",\n    color = \"Day of Week\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "appendix/appendix.html#total-septa-bus-ridership-by-day-of-week",
    "href": "appendix/appendix.html#total-septa-bus-ridership-by-day-of-week",
    "title": "Technical Appendix",
    "section": "Total SEPTA Bus Ridership by Day of Week",
    "text": "Total SEPTA Bus Ridership by Day of Week\n\n\nCode\n# Aggregate to total ridership by year and day-of-week\nbus_tract_year_dow &lt;- bus_tract_phila |&gt;\n  group_by(year, Day_of_Week) |&gt;\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Minimal line plot of total ridership over time by day-of-week\nggplot(bus_tract_year_dow,\n       aes(x = year, y = total_ridership, color = Day_of_Week)) +\n  geom_line(linewidth = 0.9) +\n  geom_point(size = 1.8) +\n  labs(\n    title = \"Total SEPTA Bus Ridership by Day of Week\",\n    subtitle = \"Average daily boardings + departures for Fall only\",\n    x = \"Year\",\n    y = \"Total Average Daily Ridership\",\n    color = \"Day of Week\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "appendix/appendix.html#pre-vs.-post-covid-ridership-comparison",
    "href": "appendix/appendix.html#pre-vs.-post-covid-ridership-comparison",
    "title": "Technical Appendix",
    "section": "Pre vs. Post COVID Ridership Comparison",
    "text": "Pre vs. Post COVID Ridership Comparison\n\n\nCode\n# Aggregate to one row per tract-year\ntract_19_21 &lt;- bus_tract_phila |&gt;\n  filter(\n    year %in% c(2019, 2021)\n  ) |&gt;\n  group_by(Census_Tract_ID, year) |&gt;\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |&gt;\n  # Pivot to wide format for plotting\n  pivot_wider(\n    names_from = year,\n    values_from = total_ridership,\n    names_prefix = \"y\"\n  ) |&gt;\n  # Drop tracts with missing data\n  tidyr::drop_na(y2019, y2021)\n\n# Plot 2019 vs 2021 ridership scatterplot\nggplot(tract_19_21,\n       aes(x = y2019, y = y2021)) +\n  geom_point(alpha = 0.6) +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\") +\n  labs(\n    title = \"Tract-Level Weekday Ridership: 2019 vs 2021\",\n    subtitle = \"Each point represents a census tract in Philadelphia County\",\n    x = \"2019 Ridership\",\n    y = \"2021 Ridership\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "appendix/appendix.html#tract-level-total-ridership-fall-2023",
    "href": "appendix/appendix.html#tract-level-total-ridership-fall-2023",
    "title": "Technical Appendix",
    "section": "Tract-Level Total Ridership (Fall 2023)",
    "text": "Tract-Level Total Ridership (Fall 2023)\n\n\nCode\n# Tract-level total ridership, Fall 2023\ntract_2023 &lt;- bus_tract_phila |&gt;\n  filter(year == 2023) |&gt;\n  group_by(Census_Tract_ID) |&gt;\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |&gt;\n  filter(!is.na(total_ridership), total_ridership &gt; 0) |&gt;\n  # Quintiles to view meaningful patterns in plot\n  mutate(\n    ridership_q = cut_number(\n      total_ridership,\n      n = 5,\n      labels = c(\"Lowest 20%\", \"20–40%\", \"40–60%\", \"60–80%\", \"Top 20%\")\n    )\n  )\n\n# Join to tract geometries\ntract_map_2023 &lt;- tracts_sf |&gt;\n  mutate(GEOID = as.character(GEOID)) |&gt;\n  left_join(tract_2023, by = c(\"GEOID\" = \"Census_Tract_ID\"))\n\n# Plot quintiles of total ridership\nggplot(tract_map_2023) +\n  geom_sf(aes(fill = ridership_q), color = NA) +\n  scale_fill_brewer(\n    palette = \"YlGnBu\",\n    na.value = \"grey90\",\n    name = \"Quintile of\\nWeekday Ridership\"\n  ) +\n  labs(\n    title = \"Bus Ridership by Census Tract (Fall 2023)\",\n    subtitle = \"Tracts grouped into quintiles by total weekday boardings + deepartures\",\n  ) +\n  theme_minimal() +\n  theme(\n  axis.text = element_blank(),\n  axis.ticks = element_blank()\n  )"
  },
  {
    "objectID": "appendix/appendix.html#percent-change-in-tract-level-ridership-2021-2023",
    "href": "appendix/appendix.html#percent-change-in-tract-level-ridership-2021-2023",
    "title": "Technical Appendix",
    "section": "Percent Change in Tract-Level Ridership (2021-2023)",
    "text": "Percent Change in Tract-Level Ridership (2021-2023)\n\n\nCode\n# Tract-level 2019 & 2023 totals and percent change\ntract_change_21_23 &lt;- bus_tract_phila |&gt;\n  filter(\n    County_Name == \"Philadelphia County\",\n    Season %in% c(\"Fall 2021\", \"Fall 2023\"),\n    #Day_of_Week == \"Weekday\"\n  ) |&gt;\n  group_by(Census_Tract_ID, year) |&gt;\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |&gt;\n  tidyr::pivot_wider(\n    names_from = year,\n    values_from = total_ridership,\n    names_prefix = \"y\"\n  ) |&gt;\n  # Needs data from both 2021 and 2023\n  filter(!is.na(y2021), !is.na(y2023), y2021 &gt; 0) |&gt;\n  mutate(\n    pct_change_21_23 = 100 * (y2023 - y2021) / y2021\n  )\n\n# Bracket into percentage bins for plotting\nbreaks &lt;- c(-Inf, -50, -25, -10, 10, 25, 50, Inf)\nlabels &lt;- c(\"≤ -50%\", \"-50% to -25%\", \"-25% to -10%\",\n            \"-10% to +10%\", \"+10% to +25%\", \"+25% to +50%\", \"≥ +50%\")\n\ntract_change_21_23 &lt;- tract_change_21_23 |&gt;\n  mutate(\n    pct_change_cat = cut(\n      pct_change_21_23,\n      breaks = breaks,\n      labels = labels,\n      include.lowest = TRUE,\n      ordered_result = TRUE\n    )\n  )\n\n# Join to tract geometries\ntract_map_change_21_23 &lt;- tracts_sf |&gt;\n  mutate(GEOID = as.character(GEOID)) |&gt;\n  left_join(tract_change_21_23, by = c(\"GEOID\" = \"Census_Tract_ID\"))\n\n# Plot map\nggplot(tract_map_change_21_23) +\n  geom_sf(aes(fill = pct_change_cat), color = NA) +\n  scale_fill_brewer(\n    palette = \"RdYlGn\",\n    na.value = \"grey90\",\n    name = \"% change\\n2021–2023\"\n  ) +\n  labs(\n    title = \"Percent Change in Bus Ridership by Census Tract\",\n    subtitle = \"From Fall 2021 - 2023; red = loss, green = gain\",\n    caption = \"Measures Post-COVID Recovery in SEPTA Usage\"\n  ) +\n  theme_minimal() +\n  theme(\n  axis.text = element_blank(),\n  axis.ticks = element_blank()\n  )"
  },
  {
    "objectID": "appendix/appendix.html#fishnet-grid-ridership-bus-stops",
    "href": "appendix/appendix.html#fishnet-grid-ridership-bus-stops",
    "title": "Technical Appendix",
    "section": "Fishnet Grid: Ridership + Bus Stops",
    "text": "Fishnet Grid: Ridership + Bus Stops\n\n\nCode\n# 4. Fishnet Analysis (Stop Density & Weekday Ridership)\n\n# 1. Prepare 2023 Data (Weekday Only)\nstops_2023_sf &lt;- bus_stops_clean |&gt;\n  filter(year == 2023) |&gt;\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) |&gt;\n  st_transform(26918)\n\n# 2. Create Fishnet Grid (500m)\n# Use the union of tracts to define the city boundary\nphilly_boundary &lt;- st_union(tracts_sf)\n\nfishnet &lt;- st_make_grid(\n  philly_boundary,\n  cellsize = 500, # 500m x 500m\n  square = TRUE\n) |&gt;\n  st_as_sf() |&gt;\n  mutate(grid_id = row_number())\n\n# Clip grid to city shape (optional, makes map cleaner)\nfishnet &lt;- fishnet[philly_boundary, ]\n\n# 3. Aggregate Stops to Grid\n# Spatial join: Assign grid_id to each stop\nstops_joined &lt;- st_join(stops_2023_sf, fishnet, join = st_within)\n\n# Summarize data by grid cell\nfishnet_agg &lt;- stops_joined |&gt;\n  st_drop_geometry() |&gt; \n  group_by(grid_id) |&gt;\n  summarise(\n    countStops = n(),\n    totalRid = sum(total_weekday, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Join back to grid geometry for plotting\nfishnet_plot_data &lt;- fishnet |&gt;\n  left_join(fishnet_agg, by = \"grid_id\") |&gt;\n  # Replace NAs with 0 so empty cells plot as \"0\" instead of gray/missing\n  mutate(\n    countStops = replace_na(countStops, 0),\n    totalRid   = replace_na(totalRid, 0)\n  )\n\n# 4. Plotting\n\n# Plot A: Ridership Intensity\np_rid &lt;- ggplot() +\n  geom_sf(data = fishnet_plot_data, aes(fill = totalRid), color = NA) +\n  geom_sf(data = philly_boundary, fill = NA, color = \"white\", size = 0.5) +\n  scale_fill_viridis_c(\n    name = \"Weekday\\nRidership\",\n    trans = \"sqrt\",\n    option = \"plasma\"\n  ) +\n  labs(\n    title = \"Ridership Density\",\n    subtitle = \"500m Grid, Fall 2023\"\n  ) +\n  theme_void()\n\n# Plot B: Stop Density\np_stops &lt;- ggplot() +\n  geom_sf(data = fishnet_plot_data, aes(fill = countStops), color = NA) +\n  geom_sf(data = philly_boundary, fill = NA, color = \"white\", size = 0.5) +\n  scale_fill_viridis_c(\n    name = \"Stop Count\",\n    trans = \"sqrt\",\n    option = \"viridis\"\n  ) +\n  labs(\n    title = \"Stop Density\",\n    subtitle = \"500m Grid, Fall 2023\"\n  ) +\n  theme_void()\n\n# Display side-by-side\np_rid + p_stops + \n  plot_annotation(\n    title = \"Comparison of Daily Weekday Ridership and Bus Stop Densities\",\n    theme = theme(plot.title = element_text(size = 16, face = \"bold\"))\n  )"
  },
  {
    "objectID": "appendix/appendix.html#prepare-tract-level-data",
    "href": "appendix/appendix.html#prepare-tract-level-data",
    "title": "Technical Appendix",
    "section": "Prepare Tract-Level Data",
    "text": "Prepare Tract-Level Data\n\n\nCode\nbus_tract_year &lt;- bus_tract_clean |&gt;\n  filter(Day_of_Week == \"Weekday\") |&gt;\n  group_by(Census_Tract_ID, Census_Tract_Name, year) |&gt;\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |&gt;\n  arrange(Census_Tract_ID, year) |&gt;\n  group_by(Census_Tract_ID) |&gt;\n  mutate(\n    trend = year - min(year, na.rm = TRUE), # Fill in for year FE\n    post_covid = if_else(year &gt;= 2021, 1L, 0L)\n  ) |&gt;\n  ungroup() |&gt;\n  filter(total_ridership &gt; 0)"
  },
  {
    "objectID": "appendix/appendix.html#temporal-traintest-split",
    "href": "appendix/appendix.html#temporal-traintest-split",
    "title": "Technical Appendix",
    "section": "Temporal Train/Test Split",
    "text": "Temporal Train/Test Split\n\n\nCode\n# TRAIN = pre-COVID + two recovery year (2017-19, 2021-2022)\ntract_train &lt;- bus_tract_year |&gt;\n  filter(year != 2023)\n\n# TEST = heldout, evaluation year (2023)\ntract_test &lt;- bus_tract_year |&gt;\n  filter(year == 2023)"
  },
  {
    "objectID": "appendix/appendix.html#mean-absolute-error-mae-function",
    "href": "appendix/appendix.html#mean-absolute-error-mae-function",
    "title": "Technical Appendix",
    "section": "Mean Absolute Error (MAE) Function",
    "text": "Mean Absolute Error (MAE) Function\n\n\nCode\nmae &lt;- function(obs, pred) mean(abs(obs - pred))"
  },
  {
    "objectID": "appendix/appendix.html#baseline-model-1-trend-post_covid-tract-fe",
    "href": "appendix/appendix.html#baseline-model-1-trend-post_covid-tract-fe",
    "title": "Technical Appendix",
    "section": "Baseline Model 1: Trend + Post_Covid + Tract FE",
    "text": "Baseline Model 1: Trend + Post_Covid + Tract FE\n\nPoisson Model\n\n\nCode\n# Train Poisson model\nm1_pois &lt;- glm(\n  total_ridership ~ trend + post_covid + factor(Census_Tract_ID),\n  data = tract_train,\n  family = \"poisson\"\n)\n\n# Predict on test set (2023)\ntract_test &lt;- tract_test |&gt;\n  mutate(pred_m1_pois = predict(m1_pois, newdata = tract_test, type = \"response\"))\n\n# Calculate MAE\nmae_m1_pois &lt;- mae(tract_test$total_ridership, tract_test$pred_m1_pois)\nmae_m1_pois\n\n\n[1] 309.3439\n\n\n\n\nCheck For Overispersion\n\n\nCode\n# Calculate dispersion parameter\ndispersion &lt;- sum(residuals(m1_pois, type = \"pearson\")^2) / \n              m1_pois$df.residual\n\ncat(\"Dispersion parameter:\", round(dispersion, 2), \"\\n\")\n\n\nDispersion parameter: 87.34 \n\n\nCode\ncat(\"Rule of thumb: &gt;1.5 suggests overdispersion\\n\")\n\n\nRule of thumb: &gt;1.5 suggests overdispersion\n\n\nCode\nif (dispersion &gt; 1.5) {\n  cat(\"⚠ Overdispersion detected! Consider Negative Binomial model.\\n\")\n} else {\n  cat(\"✓ Dispersion looks okay for Poisson model.\\n\")\n}\n\n\n⚠ Overdispersion detected! Consider Negative Binomial model.\n\n\n\n\nTransition to Negative Binomial Model\n\n\nCode\n# Train Negative Binomial model\nm1 &lt;- glm.nb(\n  total_ridership ~ trend + post_covid + factor(Census_Tract_ID),\n  data = tract_train\n)\n\n# Predict on test set (2023)\ntract_test &lt;- tract_test |&gt;\n  mutate(pred_m1 = predict(m1, newdata = tract_test, type = \"response\"))\n\n# Calculate MAE\nmae_m1 &lt;- mae(tract_test$total_ridership, tract_test$pred_m1)\nmae_m1\n\n\n[1] 237.7002"
  },
  {
    "objectID": "appendix/appendix.html#model-2-bus-stop-density-distance-to-nearest-railtrolley-stop",
    "href": "appendix/appendix.html#model-2-bus-stop-density-distance-to-nearest-railtrolley-stop",
    "title": "Technical Appendix",
    "section": "Model 2: + Bus Stop Density, Distance to Nearest Rail/Trolley Stop",
    "text": "Model 2: + Bus Stop Density, Distance to Nearest Rail/Trolley Stop\n\nFeature Engineering: Bus Stop Densities\n\n\nCode\n# Census Tract Area (in squared km)\ntracts_sf_utm &lt;- tracts_sf |&gt;\n  st_transform(26918) |&gt;\n  mutate(\n    Census_Tract_ID = as.character(GEOID),\n    area_km2 = as.numeric(st_area(geometry)) / 1e6\n  )\n\n# Transform bus_stops_clean into a sf\nstops_sf_all &lt;- bus_stops_clean |&gt;\n  st_as_sf(coords = c(\"Lon\", \"Lat\"), crs = 4326) |&gt;\n  st_transform(26918)\n\n# Spatial join: tracts to stops\nstops_with_tract &lt;- st_join(\n  stops_sf_all,\n  tracts_sf_utm |&gt; dplyr::select(Census_Tract_ID),\n  join = st_within\n) |&gt;\n  st_drop_geometry()# Transform back to tibble\n\n\n\n\nCode\n# Aggregate number of bus stops for each tract/year combo\nstops_tract_year &lt;- stops_with_tract |&gt;\n  filter(!is.na(Census_Tract_ID)) |&gt;\n  group_by(Census_Tract_ID, year) |&gt;\n  summarise(\n    n_stops = n(),\n    .groups = \"drop\"\n  )\n\n\n\n\nCode\n# Engineer bus stop + total rider density for each tract\nstops_tract_year &lt;- stops_tract_year |&gt;\n  # Join in tract area\n  left_join(\n    tracts_sf_utm |&gt; st_drop_geometry() |&gt;\n      dplyr::select(Census_Tract_ID, area_km2),\n    by = \"Census_Tract_ID\"\n  ) |&gt;\n  mutate(\n    stop_density = n_stops / area_km2\n  )\n\n# Join to tract-weekday panel\nbus_tract_year &lt;- bus_tract_year |&gt;\n  left_join(\n    stops_tract_year,\n    by = c(\"Census_Tract_ID\", \"year\")\n  )\n\n\n\n\nFeature Engineering: Distance to Nearest Rail/Trolley Stop\n\n\nCode\n# Extract only rail + trolley stations from all_stops\nrail_trolley_stations &lt;- all_stops |&gt;\n  filter(\n    LineAbbr %in% c(\"BSL\", \"MFL\", \"HRS\") | # Rail Line\n      str_starts(LineAbbr, \"T\") # Trolley\n  ) |&gt;\n  st_transform(26918)\n\n# Drop duplicate stations\nrail_trolley_stations &lt;- rail_trolley_stations |&gt;\n  group_by(StopId) |&gt;\n  summarise(geometry = st_union(geometry), .groups = \"drop\")\n\n\n\n\nCode\n# Tract centroids\ntract_centroids &lt;- tracts_sf_utm |&gt;\n  st_centroid()\n\n# Distance matrix from each tract to each station in meters\ndist_mat &lt;- st_distance(tract_centroids, rail_trolley_stations)\n\n# Nearest station distance per tract + convert to km\ndist_to_rail_km &lt;- apply(dist_mat, 1, min) / 1000\n\n# Create df with nearest distance metrics\ndist_rail_df &lt;- tracts_sf_utm |&gt;\n  st_drop_geometry() |&gt;\n  mutate(dist_to_rail_km = as.numeric(dist_to_rail_km)) |&gt;\n  dplyr::select(Census_Tract_ID, dist_to_rail_km)\n\n\n\n\nCode\n# Join to modeling df\nbus_tract_year &lt;- bus_tract_year |&gt;\n  left_join(dist_rail_df, by = \"Census_Tract_ID\")\n\n# Handle null values\nbus_tract_year &lt;- bus_tract_year |&gt;\n  mutate(\n    stop_density = tidyr::replace_na(stop_density, 0),\n  )\n\n# Train data\ntract_train_M2 &lt;- bus_tract_year |&gt;\n  filter(year %in% c(2017, 2018, 2019, 2021, 2022))\n\n# Test data\ntract_test_M2 &lt;- bus_tract_year |&gt;\n  filter(year == 2023)\n\n\n\n\nModeling\n\n\nCode\nm2 &lt;- glm.nb(\n  total_ridership ~ trend + post_covid + factor(Census_Tract_ID) + stop_density + dist_to_rail_km,\n  data = tract_train_M2\n)\n\ntract_test_M2 &lt;- tract_test_M2 |&gt;\n  mutate(pred_m2 = predict(m2, newdata = tract_test_M2, type = \"response\"))\n\nmae_m2 &lt;- mae(tract_test_M2$total_ridership, tract_test_M2$pred_m2)\nmae_m2\n\n\n[1] 277.1298"
  },
  {
    "objectID": "appendix/appendix.html#clean-ridership-data",
    "href": "appendix/appendix.html#clean-ridership-data",
    "title": "Technical Appendix",
    "section": "Clean Ridership Data",
    "text": "Clean Ridership Data\n\n\nCode\n# A. Clean Tract Data\nbus_tract_clean &lt;- bus_tract_raw |&gt;\n  filter(county_name == \"Philadelphia County\") |&gt;\n  mutate(\n    year = as.integer(str_extract(season, \"\\\\d{4}\")),\n    total_ridership = on + off\n  ) |&gt;\n  # Keep 2017+ for consistent analysis\n  filter(year &gt;= 2017)\n\n# B. Clean Stop Data\nbus_stops_clean &lt;- bus_stops_raw |&gt;\n  type_convert() |&gt; # Convert numbers back to numeric\n  filter(year &gt;= 2017) |&gt;\n  # Coalesce the mismatched column names from different years\n  mutate(\n    weekday_on  = coalesce(wkdy_ons, weekday_on),\n    weekday_off = coalesce(wkdy_offs, weekday_of, weekday_of),\n    saturday_on = coalesce(sat_ons, saturday_o),\n    saturday_off = coalesce(sat_offs, saturday_1),\n    sunday_on   = coalesce(sun_ons, sunday_ons),\n    sunday_off  = coalesce(sun_offs, sunday_off),\n    \n    total_weekday = weekday_on + weekday_off\n  ) |&gt;\n  # Keep only the clean columns\n  dplyr::select(year, stop_code, stop_name = stop, route, total_weekday, \n         weekday_on, weekday_off, lat, lon)"
  },
  {
    "objectID": "appendix/appendix.html#filter-transit-stops-bus-vs.-railtrolley",
    "href": "appendix/appendix.html#filter-transit-stops-bus-vs.-railtrolley",
    "title": "Technical Appendix",
    "section": "Filter Transit Stops (Bus vs. Rail/Trolley)",
    "text": "Filter Transit Stops (Bus vs. Rail/Trolley)\n\n\nCode\n# Define Rail/Trolley Codes to EXCLUDE\nrail_codes &lt;- c(\"BSL\", \"MFL\", \"HRS\", \"T1\", \"T2\", \"T3\", \"T4\", \"T5\")\n\n# 1. Rail Stops (for distance calc)\nstops_rail &lt;- all_stops |&gt;\n  filter(LineAbbr %in% rail_codes)\n\n# 2. Bus Stops (Everything else, including T4 Bus, Owls, Trackless)\nstops_bus &lt;- all_stops |&gt;\n  filter(!LineAbbr %in% rail_codes)"
  },
  {
    "objectID": "appendix/appendix.html#load-census-data",
    "href": "appendix/appendix.html#load-census-data",
    "title": "Technical Appendix",
    "section": "Load Census Data",
    "text": "Load Census Data\n\n\nCode\n# ACS Demographics (2017-2021 5-Year)\nacs_vars &lt;- c(\n  \"B01001_001\", # Total Population\n  \"B17001_002\", # Poverty: Count below poverty level\n  \"B08201_002\", # No Vehicle Available (Household)\n  \"B08201_001\"  # Total Households\n)\n\nacs_data &lt;- get_acs(\n  geography = \"tract\", state = \"PA\", county = \"Philadelphia\",\n  variables = acs_vars, year = 2021, output = \"wide\", geometry = FALSE\n) |&gt;\n  dplyr::select(GEOID, \n         pop_total = B01001_001E,\n         poverty_count = B17001_002E,\n         no_vehicle_count = B08201_002E,\n         hh_total = B08201_001E) |&gt;\n  mutate(\n    pct_poverty = poverty_count / pop_total,\n    pct_no_vehicle = no_vehicle_count / hh_total,\n    across(c(pct_poverty, pct_no_vehicle), ~replace_na(., 0)) # Null handling\n  )"
  },
  {
    "objectID": "appendix/appendix.html#spatial-engineering",
    "href": "appendix/appendix.html#spatial-engineering",
    "title": "Technical Appendix",
    "section": "Spatial Engineering",
    "text": "Spatial Engineering\n\n\nCode\n# Count Shelters per Tract\nshelters_agg &lt;- tracts_sf |&gt;\n  st_join(bus_shelters) |&gt;\n  group_by(GEOID) |&gt;\n  summarise(n_shelters = n() - sum(is.na(objectid))) |&gt; \n  st_drop_geometry()\n\n# Count Bus Stops per Tract\nstops_agg &lt;- tracts_sf |&gt;\n  st_join(stops_bus) |&gt;\n  group_by(GEOID) |&gt;\n  summarise(n_stops = n()) |&gt;\n  st_drop_geometry()\n\n# Distance to Nearest Rail Station\nrail_union &lt;- st_union(stops_rail)\ntract_centroids &lt;- st_centroid(tracts_sf)\ndist_matrix &lt;- st_distance(tract_centroids, rail_union)\n\ndist_df &lt;- tibble(\n  GEOID = tracts_sf$GEOID,\n  dist_to_rail_km = as.numeric(dist_matrix) / 1000\n)"
  },
  {
    "objectID": "appendix/appendix.html#join-dataframes-together",
    "href": "appendix/appendix.html#join-dataframes-together",
    "title": "Technical Appendix",
    "section": "Join Dataframes Together",
    "text": "Join Dataframes Together\n\n\nCode\ntract_features_static &lt;- tracts_sf |&gt;\n  mutate(area_km2 = as.numeric(st_area(geometry)) / 1e6) |&gt;\n  st_drop_geometry() |&gt;\n  left_join(acs_data, by = \"GEOID\") |&gt;\n  left_join(shelters_agg, by = \"GEOID\") |&gt;\n  left_join(stops_agg, by = \"GEOID\") |&gt;\n  left_join(dist_df, by = \"GEOID\") |&gt;\n  mutate(\n    n_stops = replace_na(n_stops, 0),\n    n_shelters = replace_na(n_shelters, 0),\n    stop_density = n_stops / area_km2,\n    pop_density = pop_total / area_km2,\n    # Equity Metric: Shelter Coverage\n    pct_sheltered = ifelse(n_stops &gt; 0, n_shelters / n_stops, 0),\n    pct_sheltered = pmin(pct_sheltered, 1) # Cap at 100%\n  )"
  },
  {
    "objectID": "appendix/appendix.html#time-series-trends",
    "href": "appendix/appendix.html#time-series-trends",
    "title": "Technical Appendix",
    "section": "Time Series Trends",
    "text": "Time Series Trends\n\nAverage Daily Ridership by Mode\n\n\nCode\n# Engineer a date feature for plotting\ntransit_mode_monthly &lt;- transit_mode |&gt;\n  mutate(\n    date = ymd(paste(Calendar_Year, Calendar_Month, \"01\", sep = \"-\"))\n  )\n\n# Plot line chart with a line for each transit mode over time\nggplot(transit_mode_monthly,\n       aes(x = date,\n           y = Average_Daily_Ridership,\n           color = Mode)) +\n  geom_line(linewidth = 1) +\n  labs(\n    title = \"Average Daily Ridership by Transit Mode\",\n    subtitle = \"SEPTA in Philadelphia from 2019 - 2025\",\n    x = \"Date\",\n    y = \"Average Daily Ridership\",\n    color = \"Transit Mode\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n\nRidership by Day of the Week\n\n\nCode\n# Aggregate to total ridership by year and day-of-week\nbus_tract_year_dow &lt;- bus_tract_clean |&gt;\n  group_by(year, day_of_week) |&gt;\n  summarise(\n    total_ridership = sum(total_ridership, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Minimal line plot of total ridership over time by day-of-week\nggplot(bus_tract_year_dow,\n       aes(x = year, y = total_ridership, color = day_of_week)) +\n  geom_line(linewidth = 0.9) +\n  geom_point(size = 1.8) +\n  labs(\n    title = \"Total SEPTA Bus Ridership by Day of Week\",\n    subtitle = \"Average daily boardings + departures for Fall only\",\n    x = \"Year\",\n    y = \"Total Average Daily Ridership\",\n    color = \"Day of Week\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "appendix/appendix.html#spatial-distributions",
    "href": "appendix/appendix.html#spatial-distributions",
    "title": "Technical Appendix",
    "section": "Spatial Distributions",
    "text": "Spatial Distributions\n\nRidership in 2023\n\n\nCode\n# Prepare 2023 Tract Data from the CLEAN objects\nridership_2023 &lt;- bus_tract_clean |&gt;\n  filter(day_of_week == \"Weekday\", year == 2023) |&gt;\n  group_by(census_tract_id) |&gt;\n  summarise(total_vol = sum(total_ridership, na.rm=TRUE))\n\n# Join to Geometry\nmap_2023 &lt;- tracts_sf |&gt;\n  left_join(ridership_2023, by = c(\"GEOID\" = \"census_tract_id\")) |&gt;\n  mutate(\n    # Create Quintiles\n    vol_quintile = ntile(total_vol, 5),\n    vol_quintile = factor(vol_quintile, labels = c(\"Lowest\", \"Low\", \"Med\", \"High\", \"Highest\"))\n  )\n\nggplot(map_2023) +\n  geom_sf(aes(fill = vol_quintile), color = NA) +\n  scale_fill_brewer(\n    palette = \"YlGnBu\",\n    na.value = \"grey90\",\n    name = \"Quintiles of Ridership\"\n  ) +\n  labs(\n    title = \"Bus Ridership by Census Tract (Fall 2023)\",\n    subtitle = \"Total Ridership = Boardings On_ + Off_\",\n  ) +\n  theme_minimal() +\n  theme(\n  axis.text = element_blank(),\n  axis.ticks = element_blank()\n  )"
  },
  {
    "objectID": "appendix/appendix.html#equity-analysis",
    "href": "appendix/appendix.html#equity-analysis",
    "title": "Technical Appendix",
    "section": "Equity Analysis",
    "text": "Equity Analysis\n\n\nCode\n# Join features to geometry for plotting\nplot_data &lt;- tracts_sf |&gt;\n  left_join(tract_features_static, by = \"GEOID\")\n\n# Map A: Poverty\np1 &lt;- ggplot(plot_data) +\n  geom_sf(aes(fill = pct_poverty), color = NA) +\n  scale_fill_viridis_c(option = \"magma\", labels = percent, name = \"Poverty %\") +\n  labs(title = \"Census Tract Poverty Rate (2021)\", subtitle = \"Where is the most financial distress?\") +\n  theme_void()\n\n# Map B: Shelter Coverage\np2 &lt;- ggplot(plot_data) +\n  geom_sf(aes(fill = pct_sheltered), color = NA) +\n  scale_fill_viridis_c(option = \"viridis\", labels = percent, name = \"Sheltered %\") +\n  labs(title = \"Percentage of Bus Stops with Shelters\", subtitle = \"Where are the highest % of shelters?\") +\n  theme_void()\n\n# Display side-by-side\np1 + p2\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Compute correlation between poverty and shelters\ncor_val &lt;- cor(tract_features_static$pct_poverty, tract_features_static$pct_sheltered, use=\"complete.obs\")\n\n# Plot scatterplot - No correlation\nggplot(tract_features_static, aes(x = pct_poverty, y = pct_sheltered)) +\n  geom_point(alpha = 0.3) +\n  geom_smooth(method = \"lm\", color = \"red\") +\n  scale_x_continuous(labels = percent) +\n  scale_y_continuous(labels = percent) +\n  labs(title = paste0(\"Correlation(Poverty, Shelters): \", round(cor_val, 2)),\n       subtitle = \"Do poorer tracts have a smaller % of bus shelters?\",\n       x = \"Poverty Rate\", y = \"Shelter Coverage\")"
  },
  {
    "objectID": "appendix/appendix.html#tract-level-ridership-comparison-covid-shock-recovery",
    "href": "appendix/appendix.html#tract-level-ridership-comparison-covid-shock-recovery",
    "title": "Technical Appendix",
    "section": "Tract-Level Ridership Comparison (COVID Shock + Recovery)",
    "text": "Tract-Level Ridership Comparison (COVID Shock + Recovery)\n\n\nCode\n# 1. Prepare Data: Calculate Change for Both Periods\nridership_periods &lt;- bus_tract_clean |&gt;\n  filter(\n    year %in% c(2019, 2021, 2023),\n    day_of_week == \"Weekday\"\n  ) |&gt;\n  group_by(census_tract_id, year) |&gt;\n  summarise(total_ridership = sum(total_ridership, na.rm = TRUE), .groups = \"drop\") |&gt;\n  pivot_wider(\n    names_from = year, \n    values_from = total_ridership, \n    names_prefix = \"vol_\"\n  ) |&gt;\n  mutate(\n    # Shock: 2019 -&gt; 2021\n    change_shock = (vol_2021 - vol_2019) / vol_2019,\n    \n    # Recovery: 2021 -&gt; 2023\n    change_recovery = (vol_2023 - vol_2021) / vol_2021,\n    \n    # Cap outliers for visualization (e.g., -100% to +100%)\n    shock_capped = pmax(pmin(change_shock, 0.5), -1),\n    recovery_capped = pmax(pmin(change_recovery, 1.0), -0.5)\n  ) |&gt;\n  drop_na(change_shock, change_recovery)\n\n# 2. Join to Geometry\nmap_periods &lt;- tracts_sf |&gt;\n  left_join(ridership_periods, by = c(\"GEOID\" = \"census_tract_id\"))\n\n# 3. Create Plots\n\n# Plot A: The COVID Shock (2019-2021)\np_shock &lt;- ggplot(map_periods) +\n  geom_sf(aes(fill = shock_capped), color = NA) +\n  scale_fill_distiller(\n    palette = \"RdBu\", direction = 1, \n    labels = scales::percent, \n    limits = c(-1, 0.5), # Fixed limits for comparison\n    name = \"Change\"\n  ) +\n  labs(title = \"The Shock (2019 → 2021)\", \n       subtitle = \"Ridership losses (pre-pandemic)\") +\n  theme_void() +\n  theme(legend.position = \"bottom\")\n\n# Plot B: The Recovery (2021-2023)\np_recovery &lt;- ggplot(map_periods) +\n  geom_sf(aes(fill = recovery_capped), color = NA) +\n  scale_fill_distiller(\n    palette = \"RdBu\", direction = 1, \n    labels = scales::percent,\n    limits = c(-0.5, 1.0), # Different limits likely needed for recovery\n    name = \"Change\"\n  ) +\n  labs(title = \"The Recovery (2021 → 2023)\", \n       subtitle = \"Ridership gains (post-pandemic)\") +\n  theme_void() +\n  theme(legend.position = \"bottom\")\n\n# 4. Combine \np_shock + p_recovery + \n  plot_annotation(\n    title = \"SEPTA Demand Resilience: Shock vs. Recovery\",\n    subtitle = \"Comparing the spatial patterns of gains/losses due to the COVID pandemic\",\n    theme = theme(plot.title = element_text(size = 16, face = \"bold\"))\n  )"
  },
  {
    "objectID": "appendix/appendix.html#setup-1",
    "href": "appendix/appendix.html#setup-1",
    "title": "Technical Appendix",
    "section": "Setup",
    "text": "Setup\n\n\nCode\n# 1. Prepare Longitudinal Panel (2017-2023)\n# Aggregate ridership to one row per Tract-Year (Weekdays only)\nbus_panel &lt;- bus_tract_clean |&gt;\n  filter(day_of_week == \"Weekday\") |&gt;\n  group_by(census_tract_id, census_tract_name, year) |&gt;\n  summarise(total_ridership = sum(total_ridership, na.rm=TRUE), .groups=\"drop\")\n\n# 2. Join with Static Features (Demographics, Shelters, Rail Dist)\nmodel_data &lt;- bus_panel |&gt;\n  left_join(tract_features_static, by = c(\"census_tract_id\" = \"GEOID\")) |&gt;\n  st_drop_geometry() |&gt; # Drop geometry\n  mutate(\n    # Time Trends\n    trend = year - min(year),\n    post_covid = if_else(year &gt;= 2021, 1, 0),\n    \n    # Log Transformations (handling zeros for density vars)\n    log_pop_density = log(pop_density + 1),\n    log_stop_density = log(stop_density + 1)\n  ) |&gt;\n  filter(!is.na(total_ridership))\n\n\n\n\nCode\n# 1. Define Error Metric\nmae &lt;- function(obs, pred) mean(abs(obs - pred))\n\n# 2. Train/Test Split\n\n# TRAIN = pre-COVID + two recovery year (2017-19, 2021-2022)\ntract_train &lt;- model_data |&gt;\n  filter(year != 2023) |&gt;\n  mutate(census_tract_id = as.factor(census_tract_id))\n\n# TEST = heldout, evaluation year (2023)\ntract_test &lt;- model_data |&gt;\n  filter(year == 2023) |&gt;\n  mutate(census_tract_id = as.factor(census_tract_id))"
  },
  {
    "objectID": "appendix/appendix.html#baseline-model-1-trend-covid-tract-fe",
    "href": "appendix/appendix.html#baseline-model-1-trend-covid-tract-fe",
    "title": "Technical Appendix",
    "section": "Baseline Model 1: Trend + COVID + Tract FE",
    "text": "Baseline Model 1: Trend + COVID + Tract FE\n\n\nCode\n# A. Fit Poisson\nm1_pois &lt;- glm(\n  total_ridership ~ trend + post_covid + census_tract_id,\n  data = tract_train,\n  family = \"poisson\"\n)\n\n# B. Check Dispersion\ndispersion &lt;- sum(residuals(m1_pois, type = \"pearson\")^2) / m1_pois$df.residual\n\ncat(\"Dispersion Parameter:\", round(dispersion, 2), \"\\n\")\n\n\nDispersion Parameter: 87.34 \n\n\nCode\nif(dispersion &gt; 1.5) cat(\"⚠️ Overdispersion detected! Switching to Negative Binomial.\\n\")\n\n\n⚠️ Overdispersion detected! Switching to Negative Binomial.\n\n\nCode\n# C. Fit Negative Binomial (The Real Baseline)\nm1_nb &lt;- glm.nb(\n  total_ridership ~ trend + post_covid + census_tract_id,\n  data = tract_train\n)\n\n# D. Evaluate\npred_m1 &lt;- predict(m1_nb, newdata = tract_test, type = \"response\")\nmae_m1  &lt;- mae(tract_test$total_ridership, pred_m1)\n\ncat(\"Baseline (M1) MAE:\", round(mae_m1, 2))\n\n\nBaseline (M1) MAE: 237.7"
  },
  {
    "objectID": "appendix/appendix.html#model-2-trend-covid-infrastructure-equity",
    "href": "appendix/appendix.html#model-2-trend-covid-infrastructure-equity",
    "title": "Technical Appendix",
    "section": "Model 2: Trend + COVID + Infrastructure + Equity",
    "text": "Model 2: Trend + COVID + Infrastructure + Equity\n\n\nCode\n# Fit Model: Demographics + Infrastructure (No Tract FE)\nm2_nb &lt;- glm.nb(\n  total_ridership ~ \n    trend + post_covid + \n    # Infrastructure Features\n    stop_density + dist_to_rail_km + pct_sheltered +\n    # Demographic Features\n    pct_poverty + pct_no_vehicle + pop_density,\n  data = tract_train\n)\n\n# Evaluate\npred_m2 &lt;- predict(m2_nb, newdata = tract_test, type = \"response\")\nmae_m2  &lt;- mae(tract_test$total_ridership, pred_m2)\n\n# Print Policy Findings\ncat(\"M2 Equity + Infrastructure (No FE) MAE:\", round(mae_m2, 2), \"\\n\")\n\n\nM2 Equity + Infrastructure (No FE) MAE: 1355.45"
  },
  {
    "objectID": "appendix/appendix.html#model-3-trend-covid-fe-covid-interactions-with-infrastructureequity",
    "href": "appendix/appendix.html#model-3-trend-covid-fe-covid-interactions-with-infrastructureequity",
    "title": "Technical Appendix",
    "section": "Model 3: Trend + COVID + FE + COVID Interactions with Infrastructure/Equity",
    "text": "Model 3: Trend + COVID + FE + COVID Interactions with Infrastructure/Equity\n\n\nCode\nm3_nb &lt;- glm.nb(\n  total_ridership ~ \n    # 1. Global Trends\n    trend + post_covid + \n    \n    # 2. Differential Recovery (Interactions)\n    # \"Did high-poverty or sheltered areas recover differently?\"\n    post_covid:pct_poverty +\n    post_covid:pct_sheltered +\n    post_covid:dist_to_rail_km +\n    \n    # 3. Local Baselines (Fixed Effects)\n    census_tract_id,\n  data = tract_train\n)\n\n# Evaluate\npred_m3 &lt;- predict(m3_nb, newdata = tract_test, type = \"response\")\nmae_m3  &lt;- mae(tract_test$total_ridership, pred_m3)\n\ncat(\"M3 FE + Interactions MAE:\", round(mae_m3, 2))\n\n\nM3 FE + Interactions MAE: 234.7"
  },
  {
    "objectID": "appendix/appendix.html#model-performance-comparison",
    "href": "appendix/appendix.html#model-performance-comparison",
    "title": "Technical Appendix",
    "section": "Model Performance Comparison",
    "text": "Model Performance Comparison\n\n\nCode\nresults &lt;- tibble(\n  Model = c(\"M1: Baseline (FE)\", \"M2: Equity + Infrastructure\", \"M3: Final (FE + Interactions)\"),\n  MAE = c(mae_m1, mae_m2, mae_m3),\n  Interpretation = c(\n    \"Controls for local history only.\",\n    \"Tests policy variables (Shelters/Poverty).\",\n    \"Combines Local history + Equity-driven recovery.\"\n  )\n)\n\nkable(results, digits = 2) |&gt;\n  kable_styling(bootstrap_options = \"striped\", full_width = F)\n\n\n\n\n\nModel\nMAE\nInterpretation\n\n\n\n\nM1: Baseline (FE)\n237.70\nControls for local history only.\n\n\nM2: Equity + Infrastructure\n1355.45\nTests policy variables (Shelters/Poverty).\n\n\nM3: Final (FE + Interactions)\n234.70\nCombines Local history + Equity-driven recovery."
  }
]